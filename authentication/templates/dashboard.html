{% load static %} <!--load static so that we can use static folder files-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>

  <!--Load Static Files and use dashboard.css file-->
  <link rel="stylesheet" href="{% static 'css/dashboard.css' %}" />

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
    integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
    integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js"
    integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js"
    integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
    crossorigin="anonymous"></script>
</head>

<body>
  <nav>
    <ul>
      <li>
        <a href="#">Dashboard</a>
        <a href="{% url 'logout'%}" id="logout">Logout</a>
        <button type="button" data-toggle="modal" data-target="#pass" class="passw">
          Change Password
        </button>
      </li>
    </ul>
  </nav>

  {% for message in messages %}
    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
    <strong>Message:</strong> {{ message }}
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
    <span aria-hidden="true">&times;</span>
    </button>
    </div>
  {% endfor %}
  <!--Check if user is authenticated then navigate user to dashboard.-->
  {% if user.is_authenticated %}
  <h3>Welcome to Dashboard {{ request.user.first_name }}</h3>
  <h3>You are successfully logged in.</h3>
  <h3>Welcome</h3>

  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
    ADD BOOK
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Add Book Here</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form method="POST" name="myForm1" class="post-form" action="{% url 'addbooks' %}"
            enctype="multipart/form-data" onsubmit="return validateForm()">
            {% csrf_token %}
            <div class="form-group" id="bookname">
              <label>Book Name</label>
              <input type="text" class="form-control" aria-describedby="bookHelp" placeholder="Enter Book Name"
                name="bookname" required>
              <div class="error"></div>
            </div>
            <div class="form-group" id="authorname">
              <label>Author Name</label>
              <input type="text" class="form-control" placeholder="Enter Author name here" name="authorname" required>
              <div class="error"></div>
            </div>
            <div class="form-group" id="bookimage">
              <label>Add Book Image</label>
              <input type="file" class="form-control" name="bookimage" required>
              <div class="error"></div>
            </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary" value="Submit">Save Changes</button>
        </div>
        </form>
      </div>
    </div>
  </div>
  {% if books %}
  <h1 class="mt-5 bg-light">My Books</h1>

  <table class="table table-striped table-bordered table-sm">
    <thead class="bg-primary">
      <tr>
        <th>Name</th>
        <th>Author</th>
        <th>Book-Image</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for book in books %}
      <tr>
        <td width="320px">{{ book.bookname }}</td>
        <td width="320px">{{ book.authorname }}</td>

        <!--Showing image-->
        <td width="320px"><img src="/media/{{book.bookimage }}" alt="{{book.bookiamge}}" width="120" height="120" /></td>
        <td>
          <!-- Edit Section Starts here-->
          <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleEdit{{ book.id }}">
            EDIT
          </button>

          <div class="modal fade" id="exampleEdit{{ book.id }}" tabindex="-1" role="dialog"
            aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="exampleModalLabel">Edit Book Here</h5>
                  <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                  </button>
                </div>

                <div class="modal-body">
                  <form method="POST" name="myForm" class="post-form" onsubmit="return validateForm()"
                    action="{% url 'edit' book.id %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="form-group" id="bookname">
                      <label>Book Name </label>
                      <input type="text" class="form-control" aria-describedby="bookHelp" placeholder="Enter Book Name"
                        name="bookname" value="{{ book.bookname }}">
                      <div class="error"></div>
                    </div>
                    <div class="form-group" id="authorname">
                      <label>Author Name</label>
                      <input type="text" class="form-control" placeholder="Enter Author name here" name="authorname"
                        value="{{ book.authorname }}">
                      <div class="error"></div>
                    </div>
                    <div class="form-group" id="bookimage">
                      <label>Add Book Image</label>
                      <input type="file" accept="image/png, image/gif, image/jpeg" class="form-control" 
                      name="bookimage" value="{{ book.bookimage }}">
                      <div class="error"></div>
                    </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                  <button type="submit" class="btn btn-primary">Save Changes</button>
                 </div>
                 </form>
              </div>
            </div>
          </div>

          <!--Navigate to Delete Function -->
          <button type="submit" class="btn btn-primary" data-toggle="modal" data-target="#exampleDelete{{book.id}}">
            DELETE
          </button>
        </td>
      </tr>
      <!-- <a class="text-white" href="{% url 'delete' book.id %}">Delete</a> -->
    </tbody>
    {% endfor %}
    {% endif %}
  </table>

  {% for book in books %}
  <!--below code confirms the deletion function-->
  <div class="modal fade" id="exampleDelete{{book.id}}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">DeleteBook</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <h6>Are you sure to delete book?</h6>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" onclick="location.href='/home/delete/{{book.id}}'">OK</button>
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
  {% endif %}

  <!--Change Password Section starts here-->
  <div class="modal fade" id="pass" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Change Password here</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <!--Added Validation of JavaScript by onsubmit-->
          <form method="POST" name="myForm2" class="post-form" onsubmit="return validateForm()"
            action="{% url 'changepassword'%}">
            {% csrf_token %}
            <div class="form-group" id="oldpass">
              <label for="exampleInputEmail1">Old Password</label>
              <input type="password" class="form-control" placeholder="Enter old password here" name="oldpassword">
              <div class="error"></div>
            </div>
            <div class="form-group" id="newpass1">
              <label for="exampleInputPassword1">New Password</label>
              <input type="password" class="form-control" placeholder="Enter new Password here" name="newpassword1">
              <div class="error"></div>
            </div>
            <div class="form-group" id="newpass2">
              <label for="exampleInputPassword2"> Confirm New Password</label>
              <input type="password" class="form-control" placeholder="Confirm new Password here" name="newpassword2">
              <div class="error"></div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              <button type="submit" class="btn btn-primary">Save Changes</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script src="{% static 'js/dashvalidate.js' %}"></script>
</body>
</html>